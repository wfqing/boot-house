<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.etoak.mapper.HouseMapper">
    <insert id="addHouse" parameterType="house">
        INSERT INTO t_boot_house(
                    province,
                    city,
                    area,
                    area_name,
                    rent_mode,
                    house_type,
                    orientation,
                    rental,
                    address,
                    pic,
                    publish_time
               )VALUES (
                    #{province},
                    #{city},
                    #{area},
                    #{areaName},
                    #{rentMode},
                    #{houseType},
                    #{orientation},
                    #{rental},
                    #{address},
                    #{pic},
                    now()
               )

    </insert>

    <select id="queryList" parameterType="housevo" resultType="housevo">
        select t.id,
				t.province,
				t.city,
				t.area,
				t.area_name as areaName,
				t2.name as rentModeName,
				t3.name as houseTypeName,
				t4.name as orientationName,
				t.rent_mode as rentMode,
				t.house_type as houseType,
				t.orientation,
				t.rental,
				t.address,
				t.pic,
				DATE_FORMAT(t.publish_time, '%Y-%m-%d %H:%i:%s') as publishTime

		from t_boot_house t
		left join t_springmvc_dict t2 on t.rent_mode = t2.value and t2.group_id = 'rent_mode'
		left join t_springmvc_dict t3 on t.house_type = t3.value and t3.group_id = 'house_type'
		left join t_springmvc_dict t4 on t.orientation = t4.value and t4.group_id = 'orientation'
		<where>
            <if test="province != null and province != 0">
                AND province = #{province}
            </if>
            <if test="city != null and city != 0">
                AND city = #{city}
            </if>
            <if test="area != null and area != 0">
                AND area = #{area}
            </if>
            <if test="rentMode != null and rentMode != 0">
                AND rent_mode = #{rentMode}
            </if>
            <if test="houseTypeList != null and houseTypeList.length != 0">
                And t.house_type IN
                <foreach collection="houseTypeList" item="houseType" open="(" close=")" separator=",">
                    #{houseType}
                </foreach>

            </if>
            <if test="orientationList != null and orientationList.size() != 0">
                AND t.orientation IN
                <foreach collection="orientationList" item="orientation" open="(" close=")" separator=",">
                    #{orientation}
                </foreach>
            </if>
            <if test="rentalMapList != null and rentalMapList.size() != 0">
                AND
                <foreach collection="rentalMapList" item="rentalMap" open="(" close=")" separator="or">
                    t.rental BETWEEN #{rentalMap.start} AND #{rentalMap.end}
                </foreach>
            </if>
        </where>
        order by t.publish_time

    </select>

</mapper>